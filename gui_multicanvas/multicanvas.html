<head>
  <meta charset="utf-8">
  <title>Multicanvas Qt</title>
</head>

<body unselectable="on">
    <button type="button" id="create-window-button" disabled>Create Window</button>

    <script type="text/javascript" src="qtloader.js"></script>
    <script type="text/javascript" src="qwm.js"></script>
    <script type="text/javascript">        

        // Application/example code
        var initialWindows = [];
        var windowCascade = 50;
        var windowIndex = 0;
        var createWindowButton = undefined;
        var qtLoader = undefined;
        
        function init()
        {
            console.log("init")
            
            // Set up "add window" buttton, but disable until Qt is ready
            createWindowButton = document.querySelector("#create-window-button");
            createWindowButton.addEventListener("click", createAdditinalWindow);
            
            // Create 4 inital windows
            initialWindows = [createNumberedWindow(1, 50, 50),
                              createNumberedWindow(2, 400, 50),
                              createNumberedWindow(3, 50, 300), 
                              createNumberedWindow(4, 400, 300)];
            windowIndex = 5;
            
            // load Qt
            loadQt();
        }
        
        function loadQt()
        {
            qtloader = QtLoader({
                canvasElements: initialWindows.map(function(window) { console.log(window.content); return window.content }),
                showError: function(errorText) {
                    console.log("error " + errorText);
                },
                showCanvas: qtReady
            });
            qtloader.loadEmscriptenModule("gui_multicanvas");
        }
        
        function qtReady()
        {
            console.log("qtReady");
            createWindowButton.disabled = false;
            initialWindows.map(function(window) { window.visible = true });
        }
        
        // Creates a <canvas> which usess 100% of the available size.
        function createCanvas(i) {
            var canvas = document.createElement("canvas");
            canvas.id = "QtCanvas" + i;
            canvas.style.width = "100%";
            canvas.style.height = "100%";
            return canvas;
        }
        
        function createNumberedWindow(number, x, y, )
        {
            var window = new Window(x, y);
            window.title = "Canvas / QScreen " + number;
            window.content = createCanvas(number);
            window.onClose(() => qtloader.removeCanvasElement(window.content));
            window.onResize(() => qtloader.resizeCanvasElement(window.content));
            return window; 
        }

        function createAdditinalWindow()
        {
            console.log("createAdditinalWindow");
            var window = createNumberedWindow(windowIndex, 10 + windowCascade, 10 + windowCascade);
            window.visible = true;
            
            qtloader.addCanvasElement(window.content);
            
            windowCascade += 25;
            windowIndex += 1;
        }

        document.addEventListener("DOMContentLoaded", init);
    </script>
</body>
</html>